<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../assets/logos/logito.ico" type="imagen/x-icon">
    <title>Find Foundations - AidSync</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/map.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="../js/header-loader.js"></script>
</head>
<body>
    <!-- Header Container -->
    <div id="header-container" class="as-header"></div>
    <button class="toggle-controls">Show Controls</button>
    <main class="map-container">
        <div class="map-controls">
            <button class="close-controls" aria-label="Close controls">&times;</button>
            <div class="filters">
                <h3>Filter by Category</h3>
                <div class="category-filters">
                    <label class="category-filter" data-category="all">
                        <input type="checkbox" checked> All Categories
                    </label>
                    <label class="category-filter" data-category="red">
                        <input type="checkbox" checked> <i class="fas fa-heartbeat" style="color: #e74c3c;"></i> Health
                    </label>
                    <label class="category-filter" data-category="blue">
                        <input type="checkbox" checked> <i class="fas fa-graduation-cap" style="color: #3498db;"></i> Education
                    </label>
                    <label class="category-filter" data-category="green">
                        <input type="checkbox" checked> <i class="fas fa-leaf" style="color: #2ecc71;"></i> Environment
                    </label>
                    <label class="category-filter" data-category="yellow">
                        <input type="checkbox" checked> <i class="fas fa-hands-helping" style="color: #f1c40f;"></i> Social Welfare
                    </label>
                </div>
                <div class="distance-filter">
                    <h3>Distance (km)</h3>
                    <select id="distance-range">
                        <option value="1">1 km</option>
                        <option value="5">5 km</option>
                        <option value="10" selected>10 km</option>
                        <option value="25">25 km</option>
                        <option value="50">50 km</option>
                        <option value="100">100 km</option>
                        <option value="0">Show All</option>
                    </select>
                </div>
                <button id="locate-me" class="btn-locate">
                    <i class="fas fa-location-arrow"></i> Use My Location
                </button>
            </div>
        </div>
        <div id="map"></div>
        <div class="map-legend">
            <h4>Legend</h4>
            <div class="legend-item"><span class="legend-color red"></span> Health</div>
            <div class="legend-item"><span class="legend-color blue"></span> Education</div>
            <div class="legend-item"><span class="legend-color green"></span> Environment</div>
            <div class="legend-item"><span class="legend-color yellow"></span> Social Welfare</div>
            <div class="legend-item"><span class="legend-color user-location"></span> Your Location</div>
        </div>
    </main>

    <!-- Foundation Info Modal -->
    <div id="foundation-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="foundation-details">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Mobile controls toggle
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.querySelector('.toggle-controls');
            const mapControls = document.querySelector('.map-controls');
            const closeBtn = document.querySelector('.close-controls');
            
            function toggleControls(show) {
                const isExpanded = show !== undefined ? show : !mapControls.classList.contains('expanded');
                mapControls.classList.toggle('expanded', isExpanded);
                toggleBtn.textContent = isExpanded ? 'Hide Controls' : 'Show Controls';
            }
            
            if (toggleBtn && mapControls) {
                // Toggle button click
                toggleBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleControls();
                });
                
                // Close button click
                if (closeBtn) {
                    closeBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        toggleControls(false);
                    });
                }
                
                // Close controls when clicking outside on mobile
                document.addEventListener('click', function(e) {
                    if (window.innerWidth <= 767 && 
                        !e.target.closest('.map-controls') && 
                        !e.target.closest('.toggle-controls') &&
                        mapControls.classList.contains('expanded')) {
                        toggleControls(false);
                    }
                });
            }
            
            // Prevent map controls from closing when clicking inside
            const mapControlsContainer = document.querySelector('.map-controls');
            if (mapControlsContainer) {
                mapControlsContainer.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.4.1/leaflet.markercluster.js"></script>
    <script src="/public/js/map.js" type="module"></script>

</body>
</html>
