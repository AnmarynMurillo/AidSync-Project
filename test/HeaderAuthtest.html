<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Header Tester - AidSync</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Main styles -->
    <link rel="stylesheet" href="../public/css/styles.css">
    
    <!-- Header styles (both guest and auth) -->
    <link rel="stylesheet" href="../src/components/css/header.css">
    <link rel="stylesheet" href="../src/components/css/auth-header.css">
    
    <style>
        /* Test page specific styles */
        :root {
            --color-primary: #4a6cf7;
            --color-success: #28a745;
            --color-danger: #dc3545;
            --color-bg: #f8f9fa;
            --color-text: #212529;
            --color-card: #fff;
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Poppins', 'Nunito', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: background var(--transition), color var(--transition);
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            padding-top: 100px; /* Space for header */
        }
        
        .test-section {
            background: var(--color-card);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }
        
        .test-btn--primary {
            background-color: var(--color-primary);
            color: white;
        }
        
        .test-btn--success {
            background-color: var(--color-success);
            color: white;
        }
        
        .test-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .test-state {
            padding: 1rem;
            background: rgba(0,0,0,0.05);
            border-radius: 6px;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
        }
        
        .test-content {
            background: var(--color-card);
            padding: 2rem;
            border-radius: 12px;
            margin-top: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: background var(--transition), box-shadow var(--transition);
        }
        
        .test-buttons {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .login-btn {
            background: var(--color-accent);
            color: white;
        }
        
        .logout-btn {
            background: #ea4335;
            color: white;
        }
        
        .simulate-user {
            background: var(--color-primary);
            color: white;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .test-btn:active {
            transform: translateY(0);
        }
        
        #testOutput {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--color-card);
            border-radius: 8px;
            border: 1px solid var(--color-border);
            font-family: monospace;
            white-space: pre-wrap;
            transition: all var(--transition);
        }
        
        .test-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            display: inline-block;
            margin-bottom: 1rem;
        }
        
        .status-logged-in {
            background: rgba(52, 168, 83, 0.1);
            color: #34a853;
        }
        
        .status-logged-out {
            background: rgba(234, 67, 53, 0.1);
            color: #ea4335;
        }
    </style>
</head>
<body>
    <!-- Header container - the loader system expects this ID -->
    <div id="header-container">
        <!-- Header will be loaded here by the loader system -->
    </div>
    
    <!-- Test content -->
    <div class="test-container">
        <h1>Header Tester</h1>
        
        <div class="test-section">
            <h2>Test Controls</h2>
            <div class="test-buttons">
                <button id="loadGuestHeader" class="test-btn test-btn--primary">
                    <i class="fas fa-user"></i> Show Guest Header
                </button>
                <button id="loadAuthHeader" class="test-btn test-btn--success">
                    <i class="fas fa-user-shield"></i> Show Authenticated Header
                </button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>Current State</h2>
            <div id="currentState" class="test-state">
                No header loaded
            </div>
        </div>
    </div>
    
    <!-- Test Content -->
    <div class="test-container">
        <div class="test-content">
            <h1>Authentication Header Test</h1>
            <p>This page tests the authentication-aware header component. Use the buttons below to simulate different authentication states.</p>
            
            <div class="test-status status-logged-out" id="authStatus">Not logged in</div>
            
            <div class="test-buttons">
                <button id="simulateLogin" class="test-btn login-btn">Simulate Login</button>
                <button id="simulateLogout" class="test-btn logout-btn" disabled>Simulate Logout</button>
                <button id="simulateUser" class="test-btn simulate-user">Load Test User</button>
            </div>
            
            <h3>User Data:</h3>
            <div id="testOutput" class="test-output">No user data available</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- Use the loader system - this will load utils.js and handle everything -->
    <script src="/src/components/js/loader.js" type="module"></script>
    
    <!-- Test controls script -->
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAJ395j9EL5Nv81Q70Csc4zRKNp5e1Xrjo",
            authDomain: "expo-project-1040e.firebaseapp.com",
            databaseURL: "https://expo-project-1040e-default-rtdb.firebaseio.com",
            projectId: "expo-project-1040e",
            storageBucket: "expo-project-1040e.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef123456"
        };
        
        // Initialize Firebase if not already initialized
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        // Initialize test controls
        function initTestControls() {
            const authStatus = document.getElementById('authStatus');
            const testOutput = document.getElementById('testOutput');
            const simulateLoginBtn = document.getElementById('simulateLogin');
            const simulateLogoutBtn = document.getElementById('simulateLogout');
            const simulateUserBtn = document.getElementById('simulateUser');
            
            // Check initial auth state
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            updateAuthUI(isLoggedIn);
            
            // Simulate login
            if (simulateLoginBtn) {
                simulateLoginBtn.addEventListener('click', () => {
                    // Simulate successful login
                    localStorage.setItem('isLoggedIn', 'true');
                    updateAuthUI(true);
                    if (simulateUserBtn) simulateUserBtn.click();
                });
            }
            
            // Simulate logout
            if (simulateLogoutBtn) {
                simulateLogoutBtn.addEventListener('click', () => {
                    // Simulate logout
                    localStorage.removeItem('isLoggedIn');
                    updateAuthUI(false);
                    testOutput.textContent = 'No user data available';
                    
                    // Hide auth header
                    const authHeader = document.getElementById('authHeader');
                    if (authHeader) {
                        authHeader.style.display = 'none';
                    }
                });
            }
            
            // Simulate user data
            if (simulateUserBtn) {
                simulateUserBtn.addEventListener('click', () => {
                    const testUser = {
                        name: 'Test User',
                        email: 'test@example.com',
                        avatar: 'https://via.placeholder.com/150',
                        role: 'tester'
                    };
                    
                    // Update UI with test user data
                    testOutput.textContent = `Name: ${testUser.name}\nEmail: ${testUser.email}\nRole: ${testUser.role}`;
                    
                    // Update auth header with test user data
                    updateAuthHeader(testUser);
                });
            }
            
            // Update auth UI based on login state
            function updateAuthUI(isLoggedIn) {
                if (!authStatus) return;
                
                if (isLoggedIn) {
                    authStatus.textContent = 'Logged in';
                    authStatus.className = 'test-status status-logged-in';
                    if (simulateLoginBtn) simulateLoginBtn.disabled = true;
                    if (simulateLogoutBtn) simulateLogoutBtn.disabled = false;
                    if (simulateUserBtn) simulateUserBtn.disabled = false;
                } else {
                    authStatus.textContent = 'Not logged in';
                    authStatus.className = 'test-status status-logged-out';
                    testOutput.textContent = 'No user data available';
                    if (simulateLoginBtn) simulateLoginBtn.disabled = false;
                    if (simulateLogoutBtn) simulateLogoutBtn.disabled = true;
                    if (simulateUserBtn) simulateUserBtn.disabled = true;
                }
            }
            
            // Update auth header with user data
            function updateAuthHeader(userData) {
                if (!userData) return;
                
                // Wait for the auth header to be fully loaded
                const checkHeader = setInterval(() => {
                    const userNameElements = document.querySelectorAll('#userName, #dropdownName, #mobileUserName');
                    const userEmailElements = document.querySelectorAll('#dropdownEmail, #mobileUserEmail');
                    const userAvatarElements = document.querySelectorAll('#userAvatar, #dropdownAvatar, #mobileUserAvatar');
                    
                    if (userNameElements.length > 0) {
                        clearInterval(checkHeader);
                        
                        // Update user info in the header
                        userNameElements.forEach(el => el.textContent = userData.name);
                        userEmailElements.forEach(el => el.textContent = userData.email);
                        userAvatarElements.forEach(el => el.src = userData.avatar);
                        
                        // Show the auth header
                        const authHeader = document.getElementById('authHeader');
                        if (authHeader) {
                            authHeader.style.display = 'block';
                        }
                    }
                }, 100);
            }
        }
        
        // Test user data
        const testUser = {
            displayName: 'Test User',
            email: 'test@example.com',
            photoURL: 'https://ui-avatars.com/api/?name=Test+User&background=4a6cf7&color=fff',
            uid: 'test123'
        };
        
        // Load header component
        async function loadHeader(type = 'guest') {
            const headerFile = type === 'auth' ? 'auth-header.html' : 'header.html';
            const headerScript = type === 'auth' ? 'auth-header.js' : 'header.js';
            const container = document.getElementById('headerContainer');
            
            if (!container) return;
            
            try {
                // Load header HTML
                const response = await fetch(`../src/components/html/${headerFile}`);
                if (!response.ok) throw new Error(`Failed to load ${type} header`);
                
                container.innerHTML = await response.text();
                updateState(`${type.toUpperCase()} header loaded`);
                
                // Load and initialize header script
                const script = document.createElement('script');
                script.src = `../src/components/js/${headerScript}`;
                script.onload = () => {
                    if (type === 'auth' && window.authHeader) {
                        // Simulate authenticated user
                        window.authHeader.currentUser = testUser;
                        window.authHeader.updateAuthUI(testUser);
                        updateState('Authenticated header initialized with test user');
                    } else if (window.header) {
                        // Initialize guest header if needed
                        window.header.init();
                        updateState('Guest header initialized');
                    }
                };
                script.onerror = () => updateState(`Error loading ${headerScript}`, true);
                document.body.appendChild(script);
                
            } catch (error) {
                console.error(`Error loading ${type} header:`, error);
                updateState(`Error: ${error.message}`, true);
            }
        }
        
        // Update state display
        function updateState(message, isError = false) {
            const stateElement = document.getElementById('currentState');
            if (stateElement) {
                stateElement.textContent = message;
                stateElement.style.color = isError ? 'var(--color-danger)' : 'inherit';
                console.log(`[Header Tester] ${message}`);
            }
        }
        
        // Initialize test page
        document.addEventListener('DOMContentLoaded', () => {
            // Set up test buttons to switch between header types
            document.getElementById('loadGuestHeader')?.addEventListener('click', () => {
                // Remove auth-page class to load guest header
                document.body.classList.remove('auth-page');
                // Reload components using utils
                if (window.loadComponents) {
                    window.loadComponents();
                }
                updateState('Switched to guest header');
            });
            
            document.getElementById('loadAuthHeader')?.addEventListener('click', () => {
                // Add auth-page class to load auth header
                document.body.classList.add('auth-page');
                // Reload components using utils
                if (window.loadComponents) {
                    window.loadComponents();
                }
                updateState('Switched to authenticated header');
            });
            
            // Initialize status
            updateState('Ready - Use buttons to switch headers');
        });
    </script>
</body>
</html>